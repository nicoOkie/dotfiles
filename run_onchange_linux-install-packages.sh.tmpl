{{- if eq .chezmoi.os "linux" -}}
#!/bin/bash
set -euo pipefail

# packages.yaml hash: {{ include ".chezmoidata/packages.yaml" | sha256sum }}

echo "üì¶ Installing Linux packages..."

# Detect distro
if [[ -f /etc/os-release ]]; then
  . /etc/os-release
  DISTRO="${ID:-linux}"
else
  echo "‚ö†Ô∏è  Cannot detect distribution"
  exit 1
fi

case "$DISTRO" in
  arch|manjaro|endeavouros)
    echo "üêß Detected Arch-based distro: $DISTRO"
    sudo pacman -Syu --noconfirm --needed \
{{ range .packages.linux.arch }}      {{ . }} \
{{ end }}    
    ;;

  debian|ubuntu|pop|linuxmint)
    echo "üêß Detected Debian-based distro: $DISTRO"
    sudo apt update
    sudo apt install -y \
{{ range .packages.linux.debian }}      {{ . }} \
{{ end }}    
    # Install packages not in apt via cargo
    if command -v cargo &> /dev/null; then
      echo "üì¶ Installing Rust-based tools via cargo..."
      cargo install eza zoxide git-delta --locked 2>/dev/null || true
    fi
    ;;

  fedora|rhel|centos)
    echo "üêß Detected Fedora/RHEL: $DISTRO"
    sudo dnf install -y \
{{ range .packages.linux.fedora }}      {{ . }} \
{{ end }}    
    ;;

  *)
    echo "‚ö†Ô∏è  Unknown distro: $DISTRO"
    echo "   Please install packages manually"
    exit 1
    ;;
esac

echo "‚úÖ Linux packages installed"
{{- end }}
